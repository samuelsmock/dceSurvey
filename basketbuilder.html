<title></title>
<!-- Add Animate.css via CDN -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet" />
<style type="text/css">/* Optional CSS styles for better presentation */
    
    #parent{
        display: flex
    }
    #left-panel{
        flex: 70;
    }

    #right-panel{

    }
    #sourceBank {
       
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            width: 20vw;
            height: 20vh;
            display: 'flex';
            
        }

    .draggable-img {
        width: 8vw;
        margin-left:2vw;
        cursor: pointer;
    }

    .stacked-img{
        width: 110%;
        height: 110%;
        overflow: hidden;
        border-radius: 50%;
    }

    #imageGrid{
        display: flex;
        
        max-width: 100%;
        max-height: 100%;
    }

    .dropped-image {
        width: 100%;
        height: 100%;
        overflow: hidden;
        border-radius: 50%;
    }

    .dropped-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    #targetCircle {
        width: 75vh;
        height: 75vh;
        border-radius: 50%;
        background-color: #fff;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
        border-width: 5cap;
        border-style: solid;
       
        
    }

    h1 {
        text-align: center;
        height: 5vh:
    }

</style>
<h1>Picture Survey</h1>
<body></body>
<div id ='parent'>
    <div id = 'left-panel'>
        <div id="sourceBank">
            <table>
                <tbody>
                    <tr>
                        <!-- 
                        <td><img onclick="selectPicture('/upload/surveys/996739/images/picture1.png', 'answer1')" /></td>
                        <td><img onclick="selectPicture('/upload/surveys/996739/images/picture2.png', 'answer2')" /></td>
                        <td><img onclick="selectPicture('/upload/surveys/996739/images/picture3.png', 'answer3')" /></td>
                        <td><img onclick="selectPicture('/upload/surveys/996739/images/picture4.png', 'answer4')" /></td>
                        <td><img onclick="selectPicture('/upload/surveys/996739/images/picture5.png', 'answer5')" /></td>
                        -->
                        
                        <td><img src = 'https://fastly.picsum.photos/id/80/200/200.jpg?hmac=uEQ6yExxeaopTOWf3oByB8KMH6Eip3-AVLN5jEMthko' class = draggable-img id="image1" draggable="true"/></td>
                        <td><img src = 'https://fastly.picsum.photos/id/955/200/200.jpg?hmac=_m3ln1pswsR9s9hWuWrwY_O6N4wizKmukfhvyaTrkjE' class = draggable-img id="image2" draggable="true"/></td>
                        <td><img src = 'https://fastly.picsum.photos/id/585/200/200.jpg?hmac=xPWUtHiddZixyCUwkNykuZcN4myA3sY2ewf9zFRc7oM' class = draggable-img id="image3" draggable="true" /></td>
                        <td><img src = 'https://fastly.picsum.photos/id/91/200/200.jpg?hmac=y-8iGl9dOkbHqADPlWuS-rWBHNBWWXlzKcsTDu2WeQo' class = draggable-img id="image4" draggable="true" /></td>
                        <td><img src = 'https://fastly.picsum.photos/id/84/200/200.jpg?hmac=6H-uafgNQmg74KSd7tSKVP1PWLigkAnXdB_PyFgxXNA' class = draggable-img id="image5" draggable="true" /></td>
                    </tr>
                </tbody>
            </table>
        </div>
    
        <div id="targetCircle">
            <text id = 'promptText'>Drop Desired Products Here!</text> 
            <!-- this will be replaced by a <div class = imageGrid> in JavaScript -->
        </div> 
    </div>

    <div id = 'right-panel'>
    <!-- Hidden input field to store the selected pictures -->

        <table>
            <thead>
                <tr>
                    <th>Product</th>
                    <th>Quantity</th>
                </tr>
            </thead>
            <tbody id="shoppingTable">
                <!-- Table content will be generated here -->
            </tbody>                                                            
        </table>

    </div>
<input id="selectedPicturesInput" name="selectedpictures" type = 'hidden' /> 


</div>

</body>

<script>

const sourceBank = document.getElementById('sourceBank');
const targetCircle = document.getElementById('targetCircle');
const selectedPicturesInput = document.getElementById('selectedPicturesInput');
const imageGrid = document.getElementById('image-grid');

let selectedImageIds = [];
let selectedImageDict = {};

const textBox = document.getElementById('promptText')


// Prevent default behavior for drag events
sourceBank.addEventListener('dragover', (e) => {
    e.preventDefault();
});


targetCircle.addEventListener('dragover', (e) => {
            e.preventDefault();
        });

// Handle image drag start
sourceBank.addEventListener('dragstart', (e) => {
    e.dataTransfer.setData('text/plain', e.target.id);
});

// Handle image drop
targetCircle.addEventListener('drop', (e) => {
    e.preventDefault();
    const imageId = e.dataTransfer.getData('text/plain');
    const imageElement = document.getElementById(imageId);              

    





 

    if (imageElement) {
        // Clone the image and add it to the target circle
        
        // if this is the first image to be dropped, delete the prompt and add a grid
        if (selectedImageIds == 0){
            var newDiv = document.createElement('div');
            newDiv.setAttribute('id', 'imageGrid');
            textBox.style.display = 'none';
            targetCircle.appendChild(newDiv);
            
        }

        // Function to add an image to the grid
        function addImage(droppedImageElement) {
            if (droppedImageElement.id in selectedImageDict) {
                // If the image already exists, stack it like two cards
                
                const stackedImage = document.getElementById(imageId + "-dropped")
                stackedImage.setAttribute('class', 'stacked-img')
                
            } else {
                // If the image is new, create a new image element
                const selectedImageGrid = document.getElementById('imageGrid')
                const clonedImage = droppedImageElement.cloneNode(true);
                clonedImage.classList.remove('draggable-img');
                clonedImage.setAttribute('class', 'dropped-image')
                clonedImage.setAttribute('id', imageId + "-dropped")
                selectedImageGrid.appendChild(clonedImage);
            }
        }
        
        addImage(imageElement)

        
       
        // Add the image ID to the selectedImageIds array and selectedImageDict
        selectedImageIds.push(imageId);
        if(imageId in selectedImageDict){
            selectedImageDict[imageId] += 1
        }
        else{
            selectedImageDict[imageId] = 1
        }

        // Update the hidden input value with the comma-separated list of selected image IDs
        selectedPicturesInput.value = selectedImageIds.join(',');

        // Get a reference to the table body
        var shoppingTable = document.getElementById('shoppingTable');
        shoppingTable.innerHTML = '';
        // Loop through the dictionary and create table rows
        for (var key in selectedImageDict) {
        if (selectedImageDict.hasOwnProperty(key)) {
            var row = shoppingTable.insertRow();
            var cell1 = row.insertCell(0); // Cell for the key
            var cell2 = row.insertCell(1); // Cell for the value

            cell1.innerHTML = key;
            cell2.innerHTML = selectedImageDict[key];
        }
        }
       

        // Reset the source image's draggable attribute so it can be dragged again
        imageElement.setAttribute('draggable', 'true');
    }
});
  </script>